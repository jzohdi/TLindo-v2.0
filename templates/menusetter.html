{% extends "layout.html" %} {% block title %} Set Menu{% endblock %} {% block
head %}
<script>
  Flask.url_for("menusetter");
</script>
<script type="text/javascript"></script>
<style></style> {{ super() }} {% endblock %} {% block main %}
<div style="margin-top: 15vh;" class="container">
  <p class="question-titles">{{ error }}</p>
  <div id="modal-holder"></div>
  <div class="row">
    <div class="main-card question-titels col-lg-10 col-lg-offset-1">
      <div class="header-size question-titles">
        Entrees included here will be included in menu options
      </div>
      <form action="{{ url_for('menusetter') }}" method="post">
        <fieldset>
          <table id="menu-setter-table" class="menu-table">
            <tr>
              <th>Item</th>
              <th>Flavors</th>
              <th>Sizes</th>
              <th>Description</th>
            </tr>
            {% for menuItem in entreeMenu %}
          
            <tr>
              <td>
                <input
                  type="text"
                  name="{{ loop.index - 1 }}"
                  autocomplete="off"
                  class="form-input-box"
                  value="{{ menuItem.item }}"
                />
              </td>
              <td>
                <input
                  autocomplete="off"
                  class="form-input-box"
                  name="{{ loop.index - 1 }}"
                  type="text"
                  value="{{ menuItem.flavors }}"
                />
              </td>
              <td>
                <input
                  autocomplete="off"
                  class="form-input-box"
                  name="{{ loop.index - 1}}"
                  type="text"
                  value="{{ menuItem.sizes }}"
                />
              </td>
              <td>
                <input
                  id="{{ loop.index - 1}}description"
                  autocomplete="off"
                  onclick="showModal('#modal-holder', '{{ loop.index - 1}}description')"
                  class="form-input-box description"
                  name="{{ loop.index - 1 }}"
                  type="text"
                  value="{{ menuItem.description }}"
                />
              </td>
            </tr> 
            {% endfor %}
          </table>

          <div class="row">
            <div class="col-xs-2">
              <div
                onclick="addRow('#menu-setter-table', '', 'entree-submit')"
                class="button button1 question-titles add-row-button"
              >
                Add Row
              </div>
            </div>
            <div class="col-xs-2 col-xs-offset-8">
              <div
                onclick="deleteRow('#menu-setter-table', '')"
                class="button button1 question-titles delete-row-button"
              >
                Delete Row
              </div>
            </div>
          </div>
          <div class="form-group">
            <button
              id="entree-submit"
              name="submit-entrees"
              class="submit-button button button1"
              type="submit"
            >
              Submit
            </button>
          </div>
        </fieldset>
      </form>
    </div>
  </div>
  <div class="row">
    <div class="main-card question-titels col-lg-10 col-lg-offset-1">
      <div class="header-size question-titles">
        Sides included here will be included in menu options
      </div>
      <form action="{{ url_for('menusetter') }}" method="post">
        <fieldset>
          <table id="menu-setter-table2" class="menu-table">
            <tr>
              <th>Item</th>
              {#<!--
                <th>Flavors</th>
              -->#}
              <th>Sizes</th>
              <th>Description</th>
            </tr>
            {% for sidesItem in sidesMenu %}
            <tr>
              <td>
                <input
                  type="text"
                  name="sides{{ loop.index - 1 }}"
                  autocomplete="off"
                  class="form-input-box textarea-size"
                  value = "{{ sidesItem.item }}"
                />
              </td>
              {#<!--
                <td>
                  <input
                    autocomplete="off"
                    class="form-input-box"
                    name="sides{{ loop.index }}flavor"
                    type="text"
                  />
                </td>
              -->
              #}
              <td>
                <input
                  autocomplete="off"
                  class="form-input-box"
                  name="sides{{ loop.index - 1 }}"
                  type="text"
                  value="{{ sidesItem.sizes }}"
                />
              </td>
              <td>
                <input
                  id="sides{{ loop.index - 1 }}description"
                  autocomplete="off"
                  onclick="showModal('#modal-holder', 'sides{{ loop.index - 1 }}description')"
                  class="form-input-box description"
                  name="sides{{ loop.index - 1 }}"
                  type="text"
                  value="{{ sidesItem.description }}"
                />
              </td>
            </tr>
            {% endfor %}
          </table>

          <div class="row">
            <div class="col-xs-2">
              <div
                onclick="addRow('#menu-setter-table2', 'sides', 'sides-submit')"
                class="button button1 question-titles add-row-button"
              >
                Add Row
              </div>
            </div>
            <div class="col-xs-2 col-xs-offset-8">
              <div
                onclick="deleteRow('#menu-setter-table2', '')"
                class="button button1 question-titles delete-row-button"
              >
                Delete Row
              </div>
            </div>
          </div>
          <div class="form-group">
            <button
              id="sides-submit"
              name="submit-sides"
              class="submit-button button button1"
              type="submit"
            >
              Submit
            </button>
          </div>
        </fieldset>
      </form>
    </div>
  </div>
</div>
<script type="text/javascript">
  function showModal(tempId, idNum) {
    let id_of_element = idNum;
    if (typeof id_of_element === "number") {
      id_of_element = id_of_element.toString();
    }
    let modalDiv =
      '<div id="myModal" class="modal"><div id="add-modal-content" class="menu-modal ' +
      'col-lg-4 col-lg-offset-4 col-md-5 col-md-offset-4 col-sm-6 col-sm-offset-3 col-xs-10 col-xs-offset-1">' +
      '<span class="close">X</span><textarea id="modal-text" name="descript-text" class="menu-text"></textarea></div></div>';
    $(tempId).append(modalDiv);

    let modal = document.getElementById("myModal");
    let text_area = document.getElementById("modal-text");
    let text_target = document.getElementById(id_of_element);
    let span = document.getElementsByClassName("close")[0];
    let done = document.getElementById("done");

    text_area.value = text_target.value;

    modal.style.display = "block";

    text_area.focus();

    text_area.oninput = function() {
      text_target.value = text_area.value;
    };

    span.onclick = function() {
      modal.style.display = "none";
      $(tempId).empty();
    };
    window.onclick = function(event) {
      if (event.target == modal) {
        modal.style.display = "none";
        $(tempId).empty();
      }
    };
  }
  function addRow(idOfTable, name_prefix, submit_id) {
    let count = $(idOfTable + " tr").length - 1;

    count = count.toString();
    let table_row_div =
      "<tr>" +
      getColumnString(name_prefix, count, "item") +
      getColumn2String(name_prefix, count) +
      getColumnString(name_prefix, count, "sizes") +
      getDescriptColString(name_prefix, count) +
      "</tr>";

    $(idOfTable).append(table_row_div);
    getTitlesToValues(idOfTable, submit_id);
  }
  function deleteRow(idOfTable) {
    let count = $(idOfTable + " tr").length - 1;
    if (count >= 2) {
      $(idOfTable + " tr:last").remove();
    }
  }

  function getColumn2String(prefix, row_num) {
    if (prefix == "") {
      return (
        '<td> <input autocomplete="off" class="form-input-box" name="' +
        prefix +
        row_num +
        '" type="text" /> </td>'
      );
    }
    return "";
  }

  function getColumnString(prefix, row_num, identifier) {
    if (prefix == "" || prefix == "sides") {
      return (
        '<td><input type="text" name="' +
        prefix +
        row_num +
        '" autocomplete="off" class="form-input-box textarea-size" /> </td>'
      );
    }
    return "";
  }
  function getDescriptColString(prefix, row_num) {
    return (
      "<td>" +
      '<input id="' +
      prefix +
      row_num +
      'description" autocomplete="off" onclick="showModal(\'#modal-holder\', \'' +
      prefix +
      row_num +
      "description')\" " +
      'class="form-input-box description" name="' +
      prefix +
      row_num +
      '" type="text"/> </td>'
    );
  }

  function setColumnInputNames(idOfTable, listOfColumns) {

    let column_name;
    let name;
    let $rows = $(idOfTable + " tbody tr td");
    for (let index = 0; index < $rows.length; index++) {
      column_name = listOfColumns[index % listOfColumns.length]
      name = $($rows[index])
        .find("input")
        .attr("name");
      if (!name.includes(column_name)) {
        name = name + column_name
        $($rows[index])
          .find("input")
          .attr("name", name);
      }
     
      if ( window.device == "mobile"){
        
        setIdsAndShowModal(idOfTable, column_name, index, $rows, name);
      }
    }
  }
  function setIdsAndShowModal(idOfTable, colName, index, rows, name){

    if ( colName != "description"){
      let $id = $(rows[index]).find("input").attr("id");
      if ( $id == undefined ){

          $(rows[index]).find("input").attr("id", name);
          $(rows[index]).find("input").attr("onclick", 'showModal("#modal-holder","' + name +'")');
        
      }
    }
  }
  function getTitlesToValues(idOfTable, idOfSubmit) {
    let text = "";
    let titles = $(idOfTable + " tbody tr th");
    let menuList = [];

    $.each(titles, function(element) {
      value = titles[element].innerHTML.toLocaleLowerCase();
      text += value + ",";
      menuList.push(value);
    });
    // console.log(menuList);

    $(idOfSubmit).attr("value", text.substring(0, text.length - 1));

    setColumnInputNames(idOfTable, menuList);
  }
  getTitlesToValues("#menu-setter-table", "#entree-submit");
  getTitlesToValues("#menu-setter-table2", "#sides-submit");
</script>
{% endblock %}
